<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Formaluário de Cadastro E2E</title>
	<link rel="stylesheet" href="styles.css">
	<!-- Vinculando o arquivo app.js no head -->
	

</head>

<body>
	<header>
		<h1>E2E Treinamentos    | Bora AUTOMATIZAR</h1>
	</header>
	<main>
		<div class="form-container">
			<h2>Formulario_de_Cadasto</h2>
			<form id="userForm">
				<label for="username">nome de usuário:</label>
				<input type="text" id="username" required>
				<br>
				<label for="password">senha :</label>
				<input type="password" id="password" required>
				<br>
				<label for="fullName">Nome  completo:</label>
				<input type="text" id="fullName">
				<br>
				<button type="submit">Cadastrar .</button>
			</form>
		</div>
		<!-- Lista de Usuários abaixo do formulário -->
		<h2>Lista de Usuarios</h2>
		<ul id="userList"></ul>
	</main>
	<footer>
		<p>&copy; 2033 E2E Coders | <a href="http://www.e2ecoders.com" target="_blank">ww.e2ecoders.com</a></p>
	</footer>


	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script>
		const apiUrl = 'http://localhost:8080/api/users';
		const username = 'e2etreinamentos';
		const password = 'e2e@123';
		const authHeader = `Basic ${btoa(`${username}:${password}`)}`;

		async function cadastrarUsuario(event) {
			event.preventDefault();
			const form = event.target;
			const username = form.username.value;
			const password = form.password.value;
			const fullName = form.fullName.value;

			try {
				const response = await axios.post(apiUrl, {
					usuario: username,
					senha: password,
					nomeCompleto: fullName,
				}, {
					headers: {
						Authorization: authHeader,
					},
				});

				console.log('Resposta do servidor após o cadastro:', response.data);
				alert(response.data.message);
				form.reset();
			} catch (error) {
				console.error('Erro ao cadastrar usuário:', error.response);
				alert('Erro ao cadastrar usuário. Verifique o console para mais informações.');
			}
		}


		async function getUsers() {
			try {
				const response = await axios.get(apiUrl);
				console.log('Resposta do servidor ao obter lista de usuários:', response);
				if (response.data && Array.isArray(response.data)) {
					showUsers(response.data);
				} else {
					console.error('Resposta inválida do servidor ao obter lista de usuários:', response.data);
					alert('Erro ao obter listas de usuário. Resposta invalidada do servidores.');
				}
			} catch (error) {
				console.error('Erro ao obter lista de usuários:', error);
				alert('Erro ao obter lista de usuários. Verifique o console para mais informações.');
			}
		}
		function showUsers(users) {
			const userList = document.getElementById('userList');
			userList.innerHTML = '';
			users.forEach(user => {
				const listItem = document.createElement('li');
				listItem.innerText = `Usuário: ${user.usuario}, Nome Completo: ${user.nomeCompleto || '-'}`;
				userList.appendChild(listItem);
			});
		}

		getUsers();
		const userForm = document.getElementById('userForm');
		userForm.addEventListener('submit', cadastrarUsuario);
	</script>
</body>

</html>